<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">

<head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Lode Runner par Caroline Boudreau et Émil Dallaire</title>
    <link rel="stylesheet" type="text/css" href="" />
    <script src="initialisations.js" type="text/javascript"></script>
    <script src="niveau.js" type="text/javascript"></script>
    <script src="pointage.js" type="text/javascript"></script>
    <script src="personnage.js" type="text/javascript"></script>
    <script src="mouvementLR.js" type="text/javascript"></script>
    <!-- Code JavaScript local -->
    <script type="text/javascript">
        let objCanvas = null;
        let objC2D = null;
        let objCycleAnimation = null;

        let objPointage = null;
        let objSons = null;
        let tabObjMurs = null;
        let objNiveau = null;
        let objLodeRunner = null;
        let tabObjGardes = null;
        let tabTrous = null;

        const initAnimation = () => {
            objCanvas = document.getElementById("monCanvas");
            objCanvas.focus();
            objC2D = objCanvas.getContext("2d");

            //Initialiser les objets
            initObjNiveau();
            initTabTrous();
            initPointage();
            initObjLodeRunner();
            initObjTabGardes();
            initObjSons();

            dessiner(); // dessiner une première fois
            animer();

        }

        function effacerDessin() {
            objC2D.clearRect(0, 0, objCanvas.width, objCanvas.height);
        }

        function mettreAjourAnimation() {
            mettreAJourPositionLR();
            mettreAJourTemps();
            mettreAJourTrous();
        }

        // Un cycle d'animation	
        function animer() {
            // Requête pour le prochain cycle
            objCycleAnimation = requestAnimationFrame(animer);

            // Le cycle d'animation
            effacerDessin();
            mettreAjourAnimation();
            dessiner();
        }

        function arreterAnimation() {
            if (objCycleAnimation != null)
                cancelAnimationFrame(objCycleAnimation);
            objCycleAnimation = null;
        }

        function dessiner() {
            dessinerContour();
            dessinerNiveau();
            dessinerPointage();
            dessinerLodeRunner();
            dessinerGardes();
            if(objLodeRunner.etat == 5){
                dessinerJet();
            }
        }

    </script>

</head>

<body onload="initAnimation()">
    <canvas id="monCanvas" width="940" height="710" tabIndex="1" onkeydown="gererClavier()" >
        Votre navigateur ne supporte pas la balise canvas
    </canvas>
</body>

</html>